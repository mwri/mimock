// Package: mimock v0.1.0 (built 2017-07-18 09:41:08)
// Copyright: (C) 2017 Michael Wright <mjw@methodanalysis.com>
// License: MIT

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var t=function(){var t=function(){this.mm_objs=[]};return t.prototype.object_type=function(t){void 0===t&&(t={});for(var o=("cons"in t?t.cons:function(){}),e=("methods"in t?Object.keys(t.methods):[]),r=0;r<e.length;r++)o.prototype[e[r]]=t.methods[e[r]];return o},t.prototype.object=function(t){if("object"!==(void 0===t?"undefined":_typeof(t)))throw new Error("not an object");for(var e=0;e<this.mm_objs.length;e++)if(this.mm_objs[e].raw_obj===t)return this.mm_objs[e];var r=new o(this,t);return this.mm_objs.push(r),r},t.prototype.o=t.prototype.object,t.prototype.restore=function(){for(var t=this.mm_objs,o=t.length-1;o>=0;o--)t[o].restore()},t}(),o=function(){var t=function(t,o){this.mm_set=t,this.raw_obj=o,this.mm_methods=[]};return t.prototype.method=function(t){if("function"!=typeof this.raw_obj[t])throw new Error("not a function");for(var o=0;o<this.mm_methods.length;o++)if(this.mm_methods[o].method_name===t)return this.mm_methods[o];var r=new e(this.mm_set,this,t);return this.mm_methods.push(r),r},t.prototype.m=t.prototype.method,t.prototype.restore=function(){for(var t=this.mm_methods,o=0;o<t.length;o++)t[o].restore()},t}(),e=function(){var t=function(t,o,e){var r=o.raw_obj;this.mm_set=t,this.mm_obj=o,this.method_name=e,this.orig_fun=r[this.method_name],this.wrap_chain=[],this.call_hist=[],this.active=!0;var n=this;r[this.method_name]=function(){return n.entry(Array.prototype.slice.call(arguments))}};return t.prototype.entry=function(t){var o={called:new Date,args:t},e=new r(this,t),n=void 0,i=void 0;try{n=e.continue()}catch(t){i=t}if(o.returned=new Date,this.call_hist.push(o),void 0===i)return o.retval=n,n;throw o.exception=i,i},t.prototype.wrap=function(t){this.wrap_chain.push(t)},t.prototype.call_count=function(){return this.call_hist.length},t.prototype.calls=function(){return this.call_hist},t.prototype.restore=function(){this.mm_obj.raw_obj[this.method_name]=this.orig_fun,this.active=!1,this.wrap_chain=[]},t}(),r=function(){var t=function(t,o){this.mm_method=t,this.mm_obj=t.mm_obj,this.args=o,this.wrap_num=t.wrap_chain.length};return t.prototype.continue=function(){return 0==this.wrap_num?this.mm_method.orig_fun.apply(this.mm_obj.raw_obj,this.args):(this.wrap_num--,this.mm_method.wrap_chain[this.wrap_num].apply(this.mm_obj.raw_obj,[this]))},t}();"undefined"!=typeof module&&void 0!==module.exports?module.exports={mockset:t}:window.mockset=t}();