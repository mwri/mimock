// Package: mimock v0.2.0 (built 2017-07-20 22:24:41)
// Copyright: (C) 2017 Michael Wright <mjw@methodanalysis.com>
// License: MIT

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var t=function(){var t=function(){this.mm_objs=[],this.mm_funs=[]};return t.prototype.object_type=function(t){void 0===t&&(t={});for(var o=("cons"in t?t.cons:function(){}),n=("methods"in t?Object.keys(t.methods):[]),r=0;r<n.length;r++)o.prototype[n[r]]=t.methods[n[r]];return o},t.prototype.object=function(t){if("object"!==(void 0===t?"undefined":_typeof(t)))throw new Error("not an object");for(var n=0;n<this.mm_objs.length;n++)if(this.mm_objs[n].raw_obj===t)return this.mm_objs[n];var r=new o(this,t);return this.mm_objs.push(r),r},t.prototype.o=t.prototype.object,t.prototype.fun=function(t){if("function"!=typeof t)throw new Error("not a function");for(var o=0;o<this.mm_funs.length;o++)if(this.mm_funs[o].orig_fun===t)return this.mm_funs[o];var n=new i(this,t);return this.mm_funs.push(n),n},t.prototype.f=t.prototype.fun,t.prototype.restore=function(){for(var t=this.mm_objs,o=t.length-1;o>=0;o--)t[o].restore();for(var n=this.mm_funs,r=n.length-1;r>=0;r--)n[r].restore()},t}(),o=function(){var t=function(t,o){this.mm_set=t,this.raw_obj=o,this.mm_methods=[]};return t.prototype.method=function(t){if("function"!=typeof this.raw_obj[t])throw new Error("not a function");for(var o=0;o<this.mm_methods.length;o++)if(this.mm_methods[o].method_name===t)return this.mm_methods[o];var r=new n(this.mm_set,this,t);return this.mm_methods.push(r),r},t.prototype.m=t.prototype.method,t.prototype.restore=function(){for(var t=this.mm_methods,o=0;o<t.length;o++)t[o].restore()},t}(),n=function(){var t=function(t,o,n){var r=o.raw_obj;this.mm_set=t,this.mm_obj=o,this.method_name=n,this.orig_fun=r[this.method_name],this.wrap_chain=[],this.call_hist=[],this.active=!0;var i=this;r[this.method_name]=function(){return i.entry(Array.prototype.slice.call(arguments),this!==r)},Object.defineProperty(r[this.method_name],"name",{value:this.orig_fun.name})};return t.prototype.entry=function(t){var o={called:new Date,args:t},n=new r(this,t),i=void 0,e=void 0;try{i=n.continue()}catch(t){e=t}if(o.returned=new Date,this.call_hist.push(o),void 0===e)return o.retval=i,i;throw o.exception=e,e},t.prototype.wrap=function(t){return this.wrap_chain.push(t),this},t.prototype.call_count=function(){return this.call_hist.length},t.prototype.calls=function(){return this.call_hist},t.prototype.restore=function(){this.mm_obj.raw_obj[this.method_name]=this.orig_fun,this.active=!1,this.wrap_chain=[]},t}(),r=function(){var t=function(t,o){this.mm_method=t,this.mm_obj=t.mm_obj,this.args=o,this.wrap_num=t.wrap_chain.length};return t.prototype.continue=function(){return 0==this.wrap_num?this.mm_method.orig_fun.apply(this.mm_obj.raw_obj,this.args):(this.wrap_num--,this.mm_method.wrap_chain[this.wrap_num].apply(this.mm_obj.raw_obj,[this]))},t}(),i=function(){var t=function(t,o){this.mm_set=t,this.orig_fun=o,this.wrap_chain=[],this.call_hist=[],this.active=!0;var n=this;this.repl_fun=function(){return n.active?n.entry(this,Array.prototype.slice.call(arguments)):n.orig_fun.apply(this,arguments)},Object.defineProperty(this.repl_fun,"name",{value:this.orig_fun.name})};return t.prototype.replacement=function(){return this.repl_fun},t.prototype.entry=function(t,o){var n={called:new Date,args:o},r=new e(this,t,o),i=void 0,s=void 0;try{i=r.continue()}catch(t){s=t}if(n.returned=new Date,this.call_hist.push(n),void 0===s)return n.retval=i,i;throw n.exception=s,s},t.prototype.wrap=function(t){return this.wrap_chain.push(t),this},t.prototype.call_count=function(){return this.call_hist.length},t.prototype.calls=function(){return this.call_hist},t.prototype.restore=function(){this.active=!1,this.wrap_chain=[]},t}(),e=function(){var t=function(t,o,n){this.mm_fun=t,this.mm_obj=t.mm_obj,this.fun_bind=o,this.args=n,this.wrap_num=t.wrap_chain.length};return t.prototype.continue=function(){return 0==this.wrap_num?this.mm_fun.orig_fun.apply(this.fun_bind,this.args):(this.wrap_num--,this.mm_fun.wrap_chain[this.wrap_num].apply(this.fun_bind,[this]))},t}();"undefined"!=typeof module&&void 0!==module.exports?module.exports={mockset:t}:window.mimock={mockset:t}}();